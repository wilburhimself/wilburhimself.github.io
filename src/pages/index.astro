---
import { getCollection } from 'astro:content';
import BlogLayout from '../layouts/BlogLayout.astro';

const allPosts = (await getCollection('blog')).sort((a, b) => {
  const dateA = new Date(a.data.date);
  const dateB = new Date(b.data.date);
  return dateB.getTime() - dateA.getTime();
});

const POSTS_PER_PAGE = 10;
const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const page = 1;
const posts = allPosts.slice(0, POSTS_PER_PAGE);
---

<BlogLayout title="Home">
  <div class="posts">
    {
      posts.map((post) => (
        <div class="post post-link block border-b border-gray-light pb-4 mb-16">
          <h2 class="post-title mb-0">
            <a href={`/blog/${post.slug}/`} class="hover:text-near-black hover:no-underline">{post.data.title}</a>
          </h2>
          <p class="post-meta text-sm">{post.data.date}</p>
          <p class="post-excerpt">{post.data.excerpt || 'Read more...'}</p>
        </div>
      ))
    }
  </div>

  <!-- Pagination -->
  <div class="pagination flex justify-between items-center mt-16">
    <span></span> <!-- Empty span for spacing -->
    <div class="pagination-links">
      {
        Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (
          <a
            href={pageNum === 1 ? '/' : `/blog/page/${pageNum}/`}
            class={`px-3 py-1 mx-1 rounded ${pageNum === page ? 'bg-gray-200 font-bold' : 'hover:bg-gray-100'}`}
          >
            {pageNum}
          </a>
        ))
      }
    </div>
    {totalPages > 1 && (
      <a href="/blog/page/2/" class="text-gray-dark hover:text-near-black">
        Next â†’
      </a>
    )}
  </div>
</BlogLayout>
